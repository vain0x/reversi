(()=>{"use strict";const e=React,l=ReactDOM,t=e=>{switch(e){case"WHITE":return"BLACK";case"BLACK":return"WHITE";default:throw e}},n=(e,l)=>{const[t,n]=e;return t*l+n},r=(e,l)=>{const[t,n]=e;return 0<=t&&t<l&&0<=n&&n<l},a=(e,l)=>{const[t,n]=e,[r,a]=l;return[t+r,n+a]},u={middles:[],ends:[]},s=(e,l,t,u)=>{const s=(s,c)=>{let i=((e,l)=>[Math.floor(e/l+1e-6),e%l])(l,u);for(;;){if(i=a(i,s),!r(i,u))return null;const l=n(i,u),o=e[l];if(null==o)return null;if(o===t)return 0==c.length?null:{middles:c,ends:[l]};c.push(n(i,u))}};if(null!=e[l])return null;const c=[1,1,0,-1,-1,-1,0,1],i=[0,1,1,1,0,-1,-1,-1],o=[],d=[];for(let e=0;e<8;e++){const l=s([i[e],c[e]],[]);null!=l&&(o.push(...l.middles),d.push(...l.ends))}return 0===o.length?null:{middles:o,ends:d}},c=l=>{var r;const a=null!==(r=l.dim)&&void 0!==r?r:8,[c,o]=e.useState("BLACK"),[d,m]=e.useState((e=>{const l=[];for(let t=0;t<e;t++)for(let t=0;t<e;t++)l.push(null);const t=(e-2)/2,r=[[n([t+0,t+0],e),"BLACK"],[n([t+0,t+1],e),"WHITE"],[n([t+1,t+0],e),"WHITE"],[n([t+1,t+1],e),"BLACK"]];for(const[e,t]of r)l[e]=t;return l})(a)),[v,C]=e.useState(null),p=e.useMemo((()=>(e=>{const{dim:l,active:t,cells:n}=e,r=n.filter((e=>"BLACK"===e)).length,a=n.filter((e=>"WHITE"===e)).length,c=((e,l,t)=>0==e?"WHITE":0===l?"BLACK":e+l===t*t?e>l?"BLACK":"WHITE":null)(r,a,l),i=null==c?n.map(((e,r)=>{var a;return null!==(a=s(n,r,t,l))&&void 0!==a?a:u})):n.map((()=>u)),o=null==c&&i.every((e=>0===e.middles.length&&0===e.ends.length));return Object.assign(Object.assign({},e),{blackCount:r,whiteCount:a,prediction:i,passOnly:o,winner:c})})({dim:a,active:c,cells:d})),[a,c,d]),E=e.useCallback((e=>{C(e)}),[]),h=e.useCallback((e=>{const l=((e,l,n,r)=>{if(null!=e[l])return null;const a=s(e,l,n,r);return null==a?null:{updateActive:t,updateCells:e=>e.map(((e,t)=>t===l||a.middles.includes(t)?n:e))}})(d,e,c,a);null!=l&&(o(l.updateActive),m(l.updateCells))}),[a,c,d]),g=e.useCallback((()=>{const e=(e=>e.passOnly?{updateActive:t}:null)(p);null!=e&&o(e.updateActive)}),[a,c,p]),{blackCount:f,whiteCount:A,passOnly:b,winner:k}=p;return e.createElement("article",{className:"g-reversi g-reversi-container"},e.createElement(i,{state:p,hoveredCell:v,hover:E,put:h}),e.createElement("div",null,"黒: ",f),e.createElement("div",null,"白: ",A),null==k?e.createElement("div",null,"手番: ","BLACK"===c?"黒":"白"):e.createElement("div",{className:"winner"},"勝者: ","BLACK"===k?"黒":"白"),b?e.createElement(e.Fragment,null,e.createElement("div",null,"石を置く場所がありません。"),e.createElement("button",{type:"button",onClick:g},"パス")):null)},i=l=>{const{state:t,hoveredCell:n,hover:r,put:a}=l,{active:u,cells:s,prediction:c}=t,i=e.useCallback((()=>{r(null)}),[r]),d=e.useMemo((()=>{var e,l;return null!=n&&null!=c[n]?[...null===(e=c[n])||void 0===e?void 0:e.middles,...null===(l=c[n])||void 0===l?void 0:l.ends]:[]}),[n,c]);return e.createElement("article",{className:"board",onMouseLeave:i},s.map(((l,t)=>{var s,i;const m=0!==(null!==(i=null===(s=c[t])||void 0===s?void 0:s.middles.length)&&void 0!==i?i:0),v=d.includes(t);return m&&t===n&&(l=u),e.createElement(o,{key:t,id:t,color:l,isCandidate:m,isPredictionTarget:v,hover:r,put:a})})))},o=l=>{const{id:t,color:n,isCandidate:r,isPredictionTarget:a,hover:u,put:s}=l,c=e.useCallback((()=>{s(t)}),[t,s]),i=e.useCallback((()=>{u(t)}),[t,u]);return e.createElement("div",{key:t,className:"cell",onClick:c,onMouseEnter:i,"data-is-candidate":r,"data-is-prediction-target":a},e.createElement("div",{className:"stone","data-color":n}))},d=()=>e.createElement("main",{id:"main"},e.createElement("h1",null,"Reversi"),e.createElement(c,null));(()=>{const t=document.getElementById("app-container");l.render(e.createElement(d,null),t)})()})();