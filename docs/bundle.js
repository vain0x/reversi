(()=>{"use strict";const e=React,l=ReactDOM,t=e=>{switch(e){case"WHITE":return"BLACK";case"BLACK":return"WHITE";default:throw e}},n=e=>{const[l,t]=e;return 8*l+t},r=e=>{const[l,t]=e;return 0<=l&&l<8&&0<=t&&t<8},u=(e,l)=>{const[t,n]=e,[r,u]=l;return[t+r,n+u]},a=(e,l,t)=>{const a=(a,s)=>{let c=(e=>[Math.floor(e/8+1e-6),e%8])(l);for(;;){if(c=u(c,a),!r(c))return null;const l=n(c),o=e[l];if(null==o)return null;if(o===t)return 0==s.length?null:{middles:s,ends:[l]};s.push(n(c))}};if(null!=e[l])return null;const s=[1,1,0,-1,-1,-1,0,1],c=[0,1,1,1,0,-1,-1,-1],o=[],i=[];for(let e=0;e<8;e++){const l=a([c[e],s[e]],[]);null!=l&&(o.push(...l.middles),i.push(...l.ends))}return 0===o.length?null:{middles:o,ends:i}},s=()=>{const[l,n]=e.useState("BLACK"),[r,u]=e.useState((()=>{const e=[];for(let l=0;l<8;l++)for(let l=0;l<8;l++)e.push(null);const l=[[27,"BLACK"],[28,"WHITE"],[35,"WHITE"],[36,"BLACK"]];for(const[t,n]of l)e[t]=n;return e})()),[s,o]=e.useState(null),i=e.useCallback((e=>{o(e)}),[]),d=e.useCallback((e=>{if(null!=r[e])return;const s=a(r,e,l);null!=s&&(u((t=>t.map(((t,n)=>n===e||s.middles.includes(n)?l:t)))),n(t(l)))}),[l,r]),m=e.useMemo((()=>r.filter((e=>"WHITE"===e)).length),[r]),v=e.useMemo((()=>r.filter((e=>"BLACK"===e)).length),[r]),E=e.useMemo((()=>0==v?"WHITE":0===m?"BLACK":v+m===64?v>m?"BLACK":"WHITE":null),[m,v]),C=e.useMemo((()=>r.map(((e,t)=>a(r,t,l)))),[l,r]),h=e.useMemo((()=>null==E&&C.every((e=>null==e))),[C,E]),p=e.useCallback((()=>{h&&n(t(l))}),[l,h]);return e.createElement("article",{className:"g-reversi g-reversi-container"},e.createElement(c,{active:l,cells:r,prediction:C,hoveredCell:s,hover:i,put:d}),e.createElement("div",null,"白石 ",m),e.createElement("div",null,"黒石 ",v),null==E?e.createElement("div",null,"手番: ","BLACK"===l?"黒":"白"):e.createElement("div",{className:"winner"},"勝者: ","BLACK"===E?"黒":"白"),h?e.createElement(e.Fragment,null,e.createElement("div",null,"石を置く場所がありません。"),e.createElement("button",{type:"button",onClick:p},"パス")):null)},c=l=>{const{active:t,cells:n,prediction:r,hoveredCell:u,hover:a,put:s}=l,c=e.useCallback((()=>{a(null)}),[a]),i=e.useMemo((()=>{var e,l;return null!=u&&null!=r[u]&&null!==(l=null===(e=r[u])||void 0===e?void 0:e.middles)&&void 0!==l?l:[]}),[u,r]),d=e.useMemo((()=>{var e,l;return null!=u&&null!=r[u]&&null!==(l=null===(e=r[u])||void 0===e?void 0:e.ends)&&void 0!==l?l:[]}),[u,r]);return e.createElement("article",{className:"board",onMouseLeave:c},n.map(((l,n)=>{var c,m;const v=0!==(null!==(m=null===(c=r[n])||void 0===c?void 0:c.middles.length)&&void 0!==m?m:0),E=i.includes(n)||d.includes(n);return v&&n===u&&(l=t),e.createElement(o,{key:n,id:n,color:l,isCandidate:v,isPredictionTarget:E,hover:a,put:s})})))},o=l=>{const{id:t,color:n,isCandidate:r,isPredictionTarget:u,hover:a,put:s}=l,c=e.useCallback((()=>{s(t)}),[t,s]),o=e.useCallback((()=>{a(t)}),[t,a]);return e.createElement("div",{key:t,className:"cell",onClick:c,onMouseEnter:o,"data-is-candidate":r,"data-is-prediction-target":u},e.createElement("div",{className:"stone","data-color":n}))},i=()=>e.createElement("main",{id:"main"},e.createElement("h1",null,"Reversi"),e.createElement(s,null));(()=>{const t=document.getElementById("app-container");l.render(e.createElement(i,null),t)})()})();